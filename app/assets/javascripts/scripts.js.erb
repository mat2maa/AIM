var video1_dom, video2_dom, video_seats_dom, video_boeing_top_dom, video_boeing_full_dom, video1, video2, video_seats, video_boeing_top, video_boeing_full, t, href, step, timeout;


$(document).ready(function () {

  // enable select2 js
  $('select.select2').select2();

  // PJAX
  $(document).pjax('a:not(.no-pjax)', '[data-pjax-container]');

  $(document).on('submit', 'form:not(.no-pjax)', function (event) {
    $.pjax.submit(event, '[data-pjax-container]')
  });

  $('body').append('<div id="action-button" style="position: fixed; top: 0; left: 0; width: 100px; height: 50px; background-color: cadetblue; z-index: 3000; cursor: pointer;">Click!</div>');

  $('body').on("click", "#action-button", function () {
    playVideo(video_seats, 0, 1);
  });

  // Side Nav
  $('body').on("click", '.side-menu-link', function() {
    $('.side-menu-link').toggleClass('active');
    $('#wrap').toggleClass('active');
    return false;
  });

});

$(document).on('pjax:start', function () {
  console.log("pjax:start");
});
$(document).on('pjax:end', function () {
  console.log("pjax:end");
  videoSwitch();
  $('select.select2').select2();
});
$(document).on('pjax:click', function () {
  console.log("pjax:click");
});
$(document).on('pjax:beforeSend', function () {
  console.log("pjax:beforeSend");
});
$(document).on('pjax:send', function () {
  console.log("pjax:send");
});
$(document).on('pjax:complete', function () {
  console.log("pjax:complete");
});
$(document).on('pjax:success', function () {
  console.log("pjax:success");
});
$(document).on('pjax:error', function () {
  console.log("pjax:error");
});
$(document).on('pjax:timeout', function () {
  console.log("pjax:timeout");
});

$(document).on('nested:fieldAdded', function (event) {
  $('select.select2').select2();
});

$(window).load(function () {
  var sound;

  loadVideoAssets();
  videoSwitch();

  if ($('.audio-player')) {
    sound = $('.audio-player').attr('data-audio-file');
  }
  soundManager.setup({
    url: '/path/to/swf-files/',
    // optional: use 100% HTML5 mode where available
    // preferFlash: false,
    onready: function () {
      var mySound = soundManager.createSound({
        id: 'aSound',
        url: sound
      });
      $('.play-button').on("click", function (e) {
        e.preventDefault();
        mySound.play();
      });
      $('.stop-button').on("click", function (e) {
        e.preventDefault();
        mySound.stop();
      });
      $('.pause-button').on("click", function (e) {
        e.preventDefault();
        mySound.pause();
      });
    },
    ontimeout: function () {
      // Hrmm, SM2 could not start. Missing SWF? Flash blocked? Show an error, etc.?
    }
  });
});

function loadVideoAssets() {
  video1_dom = $('#video-background-1');
  video2_dom = $('#video-background-2');
  video_seats_dom = $('#video-background-seats');
  video_boeing_top_dom = $('#video-background-boeing-top');
  video_boeing_full_dom = $('#video-background-boeing-full');
  video1 = video1_dom.get(0);
  video2 = video2_dom.get(0);
  video_seats = video_seats_dom.get(0);
  video_boeing_top = video_boeing_top_dom.get(0);
  video_boeing_full = video_boeing_full_dom.get(0);
}

function videoSwitch() {
  href = window.location.href.split('/');
  step = href[href.length - 1];
  timeout = 0;
  console.log(href + " " + step);

  switch (step) {
    case "edit":
      $('.video > video').removeClass("in-view");
      video_boeing_full_dom.addClass("in-view");
      t = video_boeing_full.currentTime;
      if(t > 0.4) {
        video_boeing_full.currentTime = 1.5;
      } else {
        video_boeing_full.currentTime = 0.0;
        setTimeout(function() {
          playVideo(video_boeing_full, 0.0, 1.5);
        }, timeout);
      }
      break;
    case "brandings":
      $('.video > video').removeClass("in-view");
      video_boeing_full_dom.addClass("in-view");
      t = video_boeing_full.currentTime;
      if(t > 0.4) {
        video_boeing_full.currentTime = 1.5;
      } else {
        video_boeing_full.currentTime = 0.0;
        setTimeout(function() {
          playVideo(video_boeing_full, 0.0, 1.5);
        }, timeout);
      }
      break;
    case "liveries":
      $('.video > video').removeClass("in-view");
      video_boeing_full_dom.addClass("in-view");
      t = video_boeing_full.currentTime;
      if(t > 0.4) {
        video_boeing_full.currentTime = 1.5;
      } else {
        video_boeing_full.currentTime = 0.0;
        setTimeout(function() {
          playVideo(video_boeing_full, 0.0, 1.5);
        }, timeout);
      }
      break;
    case "seat_layouts":
      $('.video > video').removeClass("in-view");
      video_boeing_full_dom.addClass("in-view");
      t = video_boeing_full.currentTime;
      if(t > 1.9) {
        video_boeing_full.currentTime = 3.2;
      } else {
        video_boeing_full.currentTime = 1.5;
        setTimeout(function() {
          playVideo(video_boeing_full, 1.5, 3.2);
        }, timeout);
      }
      break;
    case "life_jackets":
      $('.video > video').removeClass("in-view");
      video_boeing_full_dom.addClass("in-view");
      t = video_boeing_full.currentTime;
      if(t > 1.9) {
        video_boeing_full.currentTime = 3.2;
      } else {
        video_boeing_full.currentTime = 1.5;
        setTimeout(function() {
          playVideo(video_boeing_full, 1.5, 3.2);
        }, timeout);
      }
      break;
    case "consoles":
      $('.video > video').removeClass("in-view");
      video_boeing_full_dom.addClass("in-view");
      t = video_boeing_full.currentTime;
      if(t > 1.9) {
        video_boeing_full.currentTime = 3.2;
      } else {
        video_boeing_full.currentTime = 1.5;
        setTimeout(function() {
          playVideo(video_boeing_full, 1.5, 3.2);
        }, timeout);
      }
      break;
    case "bins":
      $('.video > video').removeClass("in-view");
      video_boeing_full_dom.addClass("in-view");
      t = video_boeing_full.currentTime;
      if(t > 1.9) {
        video_boeing_full.currentTime = 3.2;
      } else {
        video_boeing_full.currentTime = 1.5;
        setTimeout(function() {
          playVideo(video_boeing_full, 1.5, 3.2);
        }, timeout);
      }
      break;
    case "lavatories":
      $('.video > video').removeClass("in-view");
      video_boeing_full_dom.addClass("in-view");
      t = video_boeing_full.currentTime;
      if(t > 1.9) {
        video_boeing_full.currentTime = 3.2;
      } else {
        video_boeing_full.currentTime = 1.5;
        setTimeout(function() {
          playVideo(video_boeing_full, 1.5, 3.2);
        }, timeout);
      }
      break;
    case "open_exit_doors":
      $('.video > video').removeClass("in-view");
      video_boeing_full_dom.addClass("in-view");
      t = video_boeing_full.currentTime;
      if(t > 1.9) {
        video_boeing_full.currentTime = 3.2;
      } else {
        video_boeing_full.currentTime = 1.5;
        setTimeout(function() {
          playVideo(video_boeing_full, 1.5, 3.2);
        }, timeout);
      }
      break;
    case "closed_exit_doors":
      $('.video > video').removeClass("in-view");
      video_boeing_full_dom.addClass("in-view");
      t = video_boeing_full.currentTime;
      if(t > 1.9) {
        video_boeing_full.currentTime = 3.2;
      } else {
        video_boeing_full.currentTime = 1.5;
        setTimeout(function() {
          playVideo(video_boeing_full, 1.5, 3.2);
        }, timeout);
      }
      break;
    case "carpet_textures":
      $('.video > video').removeClass("in-view");
      video_boeing_full_dom.addClass("in-view");
      t = video_boeing_full.currentTime;
      if(t > 1.9) {
        video_boeing_full.currentTime = 3.2;
      } else {
        video_boeing_full.currentTime = 1.5;
        setTimeout(function() {
          playVideo(video_boeing_full, 1.5, 3.2);
        }, timeout);
      }
      break;
    case "economy_seats":
      $('.video > video').removeClass("in-view");
      video_boeing_full_dom.addClass("in-view");
      t = video_boeing_full.currentTime;
      if(t > 3.6) {
        video_boeing_full.currentTime = 5.0;
      } else {
        video_boeing_full.currentTime = 3.2;
        setTimeout(function() {
          playVideo(video_boeing_full, 3.2, 5.0);
        }, timeout);
      }
      break;
//    case "economy_seats":
//      $('.video > video').removeClass("in-view");
//      video_seats_dom.addClass("in-view");
//      t = video_seats.currentTime;
//      if(t > 0.4) {
//        video_seats.currentTime = 0.5;
//      } else {
//        video_seats.currentTime = 0.0;
//        setTimeout(function() {
//          playVideo(video_seats, 0.0, 0.5);
//        }, timeout);
//      }
//      break;
    case "business_seats":
      $('.video > video').removeClass("in-view");
      video_boeing_full_dom.addClass("in-view");
      t = video_boeing_full.currentTime;
      if(t > 5.4) {
        video_boeing_full.currentTime = 5.6;
      } else {
        video_boeing_full.currentTime = 5.0;
        setTimeout(function() {
          playVideo(video_boeing_full, 5.0, 5.6);
        }, timeout);
      }
      break;
    case "first_class_seats":
      $('.video > video').removeClass("in-view");
      video_boeing_full_dom.addClass("in-view");
      if(t > 6.0) {
        video_boeing_full.currentTime = 6.3;
      } else {
        video_boeing_full.currentTime = 5.6;
        setTimeout(function() {
          playVideo(video_boeing_full, 5.6, 6.3);
        }, timeout);
      }
      break;
    default:
      $('.video > video').removeClass("in-view");
      break;
  }
}

function playVideo(videoAsset, start, end) {

  videoAsset.ontimeupdate = function () {
    console.log(this.currentTime);
    if (this.currentTime >= end) {
      this.pause();
    }
  };

  try {
    videoAsset.currentTime = start;
    videoAsset.play();
  } catch (ex) {
    //handle exceptions here
  }
}

function playSecond() {
  video1_dom.css('z-index', 1);
  video2_dom.css('z-index', 2);
  playVideo(video2, 0, 1);
}
